

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>chesscog.recognition package &mdash; chesscog 1.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="chesscog.report package" href="chesscog.report.html" />
    <link rel="prev" title="chesscog.piece_classifier package" href="chesscog.piece_classifier.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> chesscog
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="chesscog.html">chesscog package</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="chesscog.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="chesscog.core.html">chesscog.core package</a></li>
<li class="toctree-l3"><a class="reference internal" href="chesscog.corner_detection.html">chesscog.corner_detection package</a></li>
<li class="toctree-l3"><a class="reference internal" href="chesscog.data_synthesis.html">chesscog.data_synthesis package</a></li>
<li class="toctree-l3"><a class="reference internal" href="chesscog.occupancy_classifier.html">chesscog.occupancy_classifier package</a></li>
<li class="toctree-l3"><a class="reference internal" href="chesscog.piece_classifier.html">chesscog.piece_classifier package</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">chesscog.recognition package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#submodules">Submodules</a></li>
<li class="toctree-l4"><a class="reference internal" href="#module-chesscog.recognition.evaluate">chesscog.recognition.evaluate module</a></li>
<li class="toctree-l4"><a class="reference internal" href="#module-chesscog.recognition.recognition">chesscog.recognition.recognition module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="chesscog.report.html">chesscog.report package</a></li>
<li class="toctree-l3"><a class="reference internal" href="chesscog.transfer_learning.html">chesscog.transfer_learning package</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">chesscog</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="chesscog.html">chesscog package</a> &raquo;</li>
        
      <li>chesscog.recognition package</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/chesscog.recognition.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-chesscog.recognition">
<span id="chesscog-recognition-package"></span><h1>chesscog.recognition package<a class="headerlink" href="#module-chesscog.recognition" title="Permalink to this headline">¶</a></h1>
<p>Chess inference module that brings the whole pipeline together.</p>
<div class="section" id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-chesscog.recognition.evaluate">
<span id="chesscog-recognition-evaluate-module"></span><h2>chesscog.recognition.evaluate module<a class="headerlink" href="#module-chesscog.recognition.evaluate" title="Permalink to this headline">¶</a></h2>
<p>Script to evaluate the performance of the recognition pipeline.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> python -m chesscog.recognition.evaluate --help
<span class="go">usage: evaluate.py [-h] [--dataset {train,val,test}] [--out OUT]</span>
<span class="go">                   [--save-fens]</span>

<span class="go">Evaluate the chess recognition system end-to-end.</span>

<span class="go">optional arguments:</span>
<span class="go">  -h, --help            show this help message and exit</span>
<span class="go">  --dataset {train,val,test}</span>
<span class="go">                        the dataset to evaluate (if unspecified, train and</span>
<span class="go">                        val will be evaluated)</span>
<span class="go">  --out OUT             output folder</span>
<span class="go">  --save-fens           store predicted and actual FEN strings</span>
</pre></div>
</div>
<dl class="py function">
<dt id="chesscog.recognition.evaluate.evaluate">
<code class="sig-prename descclassname">chesscog.recognition.evaluate.</code><code class="sig-name descname">evaluate</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">recognizer</span><span class="p">:</span> <span class="n"><a class="reference internal" href="#chesscog.recognition.recognition.TimedChessRecognizer" title="chesscog.recognition.recognition.TimedChessRecognizer">chesscog.recognition.recognition.TimedChessRecognizer</a></span></em>, <em class="sig-param"><span class="n">output_file</span><span class="p">:</span> <span class="n">IO</span></em>, <em class="sig-param"><span class="n">dataset_folder</span><span class="p">:</span> <span class="n">pathlib.Path</span></em>, <em class="sig-param"><span class="n">save_fens</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#chesscog.recognition.evaluate.evaluate" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform the performance evaluation, saving the results to a CSV output file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>recognizer</strong> (<a class="reference internal" href="#chesscog.recognition.recognition.TimedChessRecognizer" title="chesscog.recognition.recognition.TimedChessRecognizer"><em>TimedChessRecognizer</em></a>) – the instance of the chess recognition pipeline</p></li>
<li><p><strong>output_file</strong> (<em>typing.IO</em>) – the output file object</p></li>
<li><p><strong>dataset_folder</strong> (<em>Path</em>) – the folder of the dataset to evaluate</p></li>
<li><p><strong>save_fens</strong> (<em>bool</em><em>, </em><em>optional</em>) – whether to save the FEN outputs for every sample. Defaults to False.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-chesscog.recognition.recognition">
<span id="chesscog-recognition-recognition-module"></span><h2>chesscog.recognition.recognition module<a class="headerlink" href="#module-chesscog.recognition.recognition" title="Permalink to this headline">¶</a></h2>
<p>Module that brings together the whole recognition pipeline into a single class so it can be conveniently executed.</p>
<p>This module simultaneously acts as a script to perform a single inference:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> python -m chesscog.recognition.recognition --help
<span class="go">usage: recognition.py [-h] [--white] [--black] file</span>

<span class="go">Run the chess recognition pipeline on an input image</span>

<span class="go">positional arguments:</span>
<span class="go">  file        path to the input image</span>

<span class="go">optional arguments:</span>
<span class="go">  -h, --help  show this help message and exit</span>
<span class="go">  --white     indicate that the image is from the white player&#39;s</span>
<span class="go">              perspective (default)</span>
<span class="go">  --black     indicate that the image is from the black player&#39;s</span>
<span class="go">              perspective</span>
</pre></div>
</div>
<dl class="py class">
<dt id="chesscog.recognition.recognition.ChessRecognizer">
<em class="property">class </em><code class="sig-prename descclassname">chesscog.recognition.recognition.</code><code class="sig-name descname">ChessRecognizer</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">classifiers_folder</span><span class="p">:</span> <span class="n">pathlib.Path</span> <span class="o">=</span> <span class="default_value">URI('models://')</span></em><span class="sig-paren">)</span><a class="headerlink" href="#chesscog.recognition.recognition.ChessRecognizer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A class implementing the entire chess inference pipeline.</p>
<p>Once you create an instance of this class, the CNNs are loaded into memory (possibly the GPU if available), so if you want to perform multiple inferences, they should all use one instance of this class for performance purposes.</p>
<dl class="py method">
<dt id="chesscog.recognition.recognition.ChessRecognizer.predict">
<code class="sig-name descname">predict</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">img</span><span class="p">:</span> <span class="n">numpy.ndarray</span></em>, <em class="sig-param"><span class="n">turn</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">True</span></em><span class="sig-paren">)</span> &#x2192; Tuple<span class="p">[</span>chess.Board<span class="p">, </span>numpy.ndarray<span class="p">]</span><a class="headerlink" href="#chesscog.recognition.recognition.ChessRecognizer.predict" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform an inference.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>img</strong> (<em>np.ndarray</em>) – the input image (RGB)</p></li>
<li><p><strong>turn</strong> (<em>chess.Color</em><em>, </em><em>optional</em>) – the current player. Defaults to chess.WHITE.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the predicted position on the board and the four corner points</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>typing.Tuple[chess.Board, np.ndarray]</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="chesscog.recognition.recognition.TimedChessRecognizer">
<em class="property">class </em><code class="sig-prename descclassname">chesscog.recognition.recognition.</code><code class="sig-name descname">TimedChessRecognizer</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">classifiers_folder</span><span class="p">:</span> <span class="n">pathlib.Path</span> <span class="o">=</span> <span class="default_value">URI('models://')</span></em><span class="sig-paren">)</span><a class="headerlink" href="#chesscog.recognition.recognition.TimedChessRecognizer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#chesscog.recognition.recognition.ChessRecognizer" title="chesscog.recognition.recognition.ChessRecognizer"><code class="xref py py-class docutils literal notranslate"><span class="pre">chesscog.recognition.recognition.ChessRecognizer</span></code></a></p>
<p>A subclass of <a class="reference internal" href="#chesscog.recognition.recognition.ChessRecognizer" title="chesscog.recognition.recognition.ChessRecognizer"><code class="xref py py-class docutils literal notranslate"><span class="pre">ChessRecognizer</span></code></a> that additionally records the time taken for each step of the pipeline during inference.</p>
<dl class="py method">
<dt id="chesscog.recognition.recognition.TimedChessRecognizer.predict">
<code class="sig-name descname">predict</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">img</span><span class="p">:</span> <span class="n">numpy.ndarray</span></em>, <em class="sig-param"><span class="n">turn</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">True</span></em><span class="sig-paren">)</span> &#x2192; Tuple<span class="p">[</span>chess.Board<span class="p">, </span>numpy.ndarray<span class="p">, </span>dict<span class="p">]</span><a class="headerlink" href="#chesscog.recognition.recognition.TimedChessRecognizer.predict" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform an inference.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>img</strong> (<em>np.ndarray</em>) – the input image (RGB)</p></li>
<li><p><strong>turn</strong> (<em>chess.Color</em><em>, </em><em>optional</em>) – the current player. Defaults to chess.WHITE.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the predicted position on the board, the four corner points, and a dict containing the time taken for each stage of the inference pipeline</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>typing.Tuple[chess.Board, np.ndarray, dict]</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt id="chesscog.recognition.recognition.main">
<code class="sig-prename descclassname">chesscog.recognition.recognition.</code><code class="sig-name descname">main</code><span class="sig-paren">(</span><em class="sig-param">classifiers_folder: pathlib.Path = URI('models://')</em>, <em class="sig-param">setup: callable = &lt;function &lt;lambda&gt;&gt;</em><span class="sig-paren">)</span><a class="headerlink" href="#chesscog.recognition.recognition.main" title="Permalink to this definition">¶</a></dt>
<dd><p>Main method for running inference from the command line.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>classifiers_folder</strong> (<em>Path</em><em>, </em><em>optional</em>) – the path to the classifiers (supplying a different path is especially useful because the transfer learning classifiers are located at <code class="docutils literal notranslate"><span class="pre">models://transfer_learning</span></code>). Defaults to <code class="docutils literal notranslate"><span class="pre">models://</span></code>.</p></li>
<li><p><strong>setup</strong> (<em>callable</em><em>, </em><em>optional</em>) – An optional setup function to be called after the CLI argument parser has been setup. Defaults to lambda:None.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="chesscog.report.html" class="btn btn-neutral float-right" title="chesscog.report package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="chesscog.piece_classifier.html" class="btn btn-neutral float-left" title="chesscog.piece_classifier package" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2021, Georg Wölflein

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>